model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  profile   MemberProfile?
  referrals Referral[]
  events    Event[]
}

model MemberProfile {
  id          Int      @id @default(autoincrement())
  userId      Int      @unique
  skills      String[]
  pastCompanies String[]
  domains     String[]
  preferences  Json?
  user        User     @relation(fields: [userId], references: [id])
}

model Job {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  tags        JobTag[]
  referrals   Referral[]
}

model JobTag {
  id        Int      @id @default(autoincrement())
  name      String
  jobId     Int
  job       Job      @relation(fields: [jobId], references: [id])
}

model Referral {
  id          Int      @id @default(autoincrement())
  jobId       Int
  userId      Int
  status      ReferralStatus
  relationType RelationType
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  job         Job      @relation(fields: [jobId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@unique([jobId, userId, relationType])
}

model Event {
  id        Int      @id @default(autoincrement())
  userId    Int
  type      EventType
  metadata  Json?
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

enum ReferralStatus {
  PENDING
  SUBMITTED
  COMPLETED
  REJECTED
}

enum RelationType {
  FRIEND
  EX_COLLEAGUE
  RELATIVE
  OTHER
}

enum EventType {
  JOB_VIEWED
  NUDGES_SHOWN
  MESSAGE_COPIED
  REFERRAL_STARTED
  REFERRAL_SUBMITTED
  REFERRAL_STATUS_CHANGED
}